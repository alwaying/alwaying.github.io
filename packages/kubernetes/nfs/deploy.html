<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nfs在kubernetes中部署 | 博客</title>
    <meta name="description" content="Vite & Vue powered static site generator.">
    <link rel="stylesheet" href="/assets/style.977da799.css">
    <link rel="modulepreload" href="/assets/app.8d41e510.js">
    <link rel="modulepreload" href="/assets/packages_kubernetes_nfs_deploy.md.5747cd9b.lean.js">
    
    <link rel="icon" href="favicon.ico">
  <meta name="twitter:title" content="nfs在kubernetes中部署 | 博客">
  <meta property="og:title" content="nfs在kubernetes中部署 | 博客">
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-e08996d6><!--[--><span tabindex="-1" data-v-45f6ae50></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-45f6ae50> Skip to content </a><!--]--><!----><header class="VPNav" data-v-e08996d6 data-v-26b787e0><div class="VPNavBar has-sidebar" data-v-26b787e0 data-v-2d9c785a><div class="container" data-v-2d9c785a><div class="VPNavBarTitle has-sidebar" data-v-2d9c785a data-v-7f390bfe><a class="title" href="/" data-v-7f390bfe><img class="logo" src="/favicon.ico" alt="Lanaya" data-v-7f390bfe> Lanaya</a></div><div class="content" data-v-2d9c785a><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-2d9c785a data-v-a30758ee><span id="main-nav-aria-label" class="visually-hidden" data-v-a30758ee>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" data-v-a30758ee data-v-74cfe2fe data-v-5704c677><!--[-->Guide<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/about/" data-v-a30758ee data-v-74cfe2fe data-v-5704c677><!--[-->About<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/packages/kubernetes/nfs/server.html" data-v-a30758ee data-v-74cfe2fe data-v-5704c677><!--[-->Kubernetes<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/packages/teamcity/" data-v-a30758ee data-v-74cfe2fe data-v-5704c677><!--[-->Teamcity<!--]--><!----></a><!--]--><!--]--></nav><!----><!----><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-2d9c785a data-v-0ae890f7 data-v-c0bcf1c2><!--[--><a class="VPSocialLink" href="https://www.github.com" title="github" target="_blank" rel="noopener noreferrer" data-v-c0bcf1c2 data-v-4231dbfc><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-4231dbfc><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="visually-hidden" data-v-4231dbfc>github</span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-2d9c785a data-v-0562f5c0 data-v-5395eaec><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-5395eaec><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-5395eaec><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-5395eaec><div class="VPMenu" data-v-5395eaec data-v-e73581a2><!----><!--[--><!--[--><!----><!----><div class="group" data-v-0562f5c0><div class="item social-links" data-v-0562f5c0><div class="VPSocialLinks social-links-list" data-v-0562f5c0 data-v-c0bcf1c2><!--[--><a class="VPSocialLink" href="https://www.github.com" title="github" target="_blank" rel="noopener noreferrer" data-v-c0bcf1c2 data-v-4231dbfc><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-4231dbfc><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="visually-hidden" data-v-4231dbfc>github</span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-2d9c785a data-v-9a8d4e0a><span class="container" data-v-9a8d4e0a><span class="top" data-v-9a8d4e0a></span><span class="middle" data-v-9a8d4e0a></span><span class="bottom" data-v-9a8d4e0a></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-e08996d6 data-v-32739260><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-32739260><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-32739260><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-32739260>Menu</span></button><a class="top-link" href="#" data-v-32739260> Return to top </a></div><aside class="VPSidebar" data-v-e08996d6 data-v-2318a78f><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-2318a78f><span class="visually-hidden" id="sidebar-aria-label" data-v-2318a78f> Sidebar Navigation </span><!--[--><div class="group" data-v-2318a78f><section class="VPSidebarGroup" data-v-2318a78f data-v-0d540144><div class="title" data-v-0d540144><h2 class="title-text" data-v-0d540144>NFS动态存储卷</h2><div class="action" data-v-0d540144><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-0d540144><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-0d540144><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-0d540144><!--[--><a class="link" href="/packages/kubernetes/nfs/server.html" data-v-0d540144 data-v-25d591ac><p class="link-text" data-v-25d591ac>NFS服务端</p></a><a class="link" href="/packages/kubernetes/nfs/client.html" data-v-0d540144 data-v-25d591ac><p class="link-text" data-v-25d591ac>NFS客户端</p></a><a class="link active" href="/packages/kubernetes/nfs/deploy.html" data-v-0d540144 data-v-25d591ac><p class="link-text" data-v-25d591ac>NFS在k8s中部署</p></a><!--]--></div></section></div><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-e08996d6 data-v-6b27f809><div class="VPDoc has-sidebar" data-v-6b27f809 data-v-b2cd70aa><div class="container" data-v-b2cd70aa><div class="aside" data-v-b2cd70aa><div class="aside-curtain" data-v-b2cd70aa></div><div class="aside-container" data-v-b2cd70aa><div class="aside-content" data-v-b2cd70aa><div class="VPDocAside" data-v-b2cd70aa data-v-779d834d><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline has-outline" data-v-779d834d data-v-ad19bccc><div class="content" data-v-ad19bccc><div class="outline-marker" data-v-ad19bccc></div><div class="outline-title" data-v-ad19bccc>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-ad19bccc><span class="visually-hidden" id="doc-outline-aria-label" data-v-ad19bccc> Table of Contents for current page </span><ul class="root" data-v-ad19bccc><!--[--><li style="" data-v-ad19bccc><a class="outline-link" href="#修改命名空间" data-v-ad19bccc>修改命名空间</a><!----></li><li style="" data-v-ad19bccc><a class="outline-link" href="#安装认证文件" data-v-ad19bccc>安装认证文件</a><!----></li><li style="" data-v-ad19bccc><a class="outline-link" href="#配置nfs-provisioner" data-v-ad19bccc>配置nfs provisioner</a><!----></li><li style="" data-v-ad19bccc><a class="outline-link" href="#部署storage-class" data-v-ad19bccc>部署storage class</a><!----></li><li style="" data-v-ad19bccc><a class="outline-link" href="#验证nfs的配置" data-v-ad19bccc>验证nfs的配置</a><!----></li><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-779d834d></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-b2cd70aa><div class="content-container" data-v-b2cd70aa><main class="main" data-v-b2cd70aa><div style="position:relative;" class="vp-doc packages" data-v-b2cd70aa><div><h1 id="nfs在kubernetes中部署" tabindex="-1">nfs在kubernetes中部署 <a class="header-anchor" href="#nfs在kubernetes中部署" aria-hidden="true">#</a></h1><p><a href="https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner" target="_blank" rel="noopener noreferrer">nfs-subdir-external-provisioner</a>下载相关文件，主要使用rbac.yaml、deployment.yaml、class.yaml三个文件，位于deploy目录下。</p><h2 id="修改命名空间" tabindex="-1">修改命名空间 <a class="header-anchor" href="#修改命名空间" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#C9D1D9;">sed -i</span><span style="color:#A5D6FF;">&#39;&#39;</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&quot;s/namespace:.*/namespace: </span><span style="color:#C9D1D9;">$NAMESPACE</span><span style="color:#A5D6FF;">/g&quot;</span><span style="color:#C9D1D9;"> ./deploy/rbac.yaml ./deploy/deployment.yaml</span></span>
<span class="line"></span></code></pre></div><h2 id="安装认证文件" tabindex="-1">安装认证文件 <a class="header-anchor" href="#安装认证文件" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#C9D1D9;">kubectl apply -f ./deploy/rbac.yaml</span></span>
<span class="line"></span></code></pre></div><p>rbac.yaml参考如下，以实际下载文件为准</p><div class="language-yaml"><span class="copy"></span><pre><code><span class="line"><span style="color:#7EE787;">apiVersion</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">v1</span></span>
<span class="line"><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">ServiceAccount</span></span>
<span class="line"><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">namespace</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">default</span></span>
<span class="line"><span style="color:#79C0FF;">---</span></span>
<span class="line"><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">ClusterRole</span></span>
<span class="line"><span style="color:#7EE787;">apiVersion</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner-runner</span></span>
<span class="line"><span style="color:#7EE787;">rules</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  - </span><span style="color:#7EE787;">apiGroups</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">resources</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;nodes&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">verbs</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;get&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;list&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;watch&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">  - </span><span style="color:#7EE787;">apiGroups</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">resources</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;persistentvolumes&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">verbs</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;get&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;list&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;watch&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;create&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;delete&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">  - </span><span style="color:#7EE787;">apiGroups</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">resources</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;persistentvolumeclaims&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">verbs</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;get&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;list&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;watch&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;update&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">  - </span><span style="color:#7EE787;">apiGroups</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;storage.k8s.io&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">resources</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;storageclasses&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">verbs</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;get&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;list&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;watch&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">  - </span><span style="color:#7EE787;">apiGroups</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">resources</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;events&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">verbs</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;create&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;update&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;patch&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#79C0FF;">---</span></span>
<span class="line"><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">ClusterRoleBinding</span></span>
<span class="line"><span style="color:#7EE787;">apiVersion</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">run-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#7EE787;">subjects</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  - </span><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">ServiceAccount</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">namespace</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">default</span></span>
<span class="line"><span style="color:#7EE787;">roleRef</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">ClusterRole</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner-runner</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">apiGroup</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#79C0FF;">---</span></span>
<span class="line"><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">Role</span></span>
<span class="line"><span style="color:#7EE787;">apiVersion</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">leader-locking-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">namespace</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">default</span></span>
<span class="line"><span style="color:#7EE787;">rules</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  - </span><span style="color:#7EE787;">apiGroups</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">resources</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;endpoints&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">verbs</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;get&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;list&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;watch&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;create&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;update&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;patch&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#79C0FF;">---</span></span>
<span class="line"><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">RoleBinding</span></span>
<span class="line"><span style="color:#7EE787;">apiVersion</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">leader-locking-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">namespace</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">default</span></span>
<span class="line"><span style="color:#7EE787;">subjects</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  - </span><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">ServiceAccount</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">namespace</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">default</span></span>
<span class="line"><span style="color:#7EE787;">roleRef</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">Role</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">leader-locking-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">apiGroup</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">rbac.authorization.k8s.io</span></span>
<span class="line"></span></code></pre></div><h2 id="配置nfs-provisioner" tabindex="-1">配置nfs provisioner <a class="header-anchor" href="#配置nfs-provisioner" aria-hidden="true">#</a></h2><p>替换原始镜像: <code>k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2</code>为<code>willdockerhub/nfs-subdir-external-provisioner:v4.0.2</code><br> 替换掉NFS_SERVER、NFS_PATH的参数值，volumes参数下的server，path参数即可，这些参数均为上述配置的NFS SERVER的信息 deployment.yaml文件内容参考如下</p><div class="language-yaml"><span class="copy"></span><pre><code><span class="line"><span style="color:#7EE787;">apiVersion</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">apps/v1</span></span>
<span class="line"><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">Deployment</span></span>
<span class="line"><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">labels</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">app</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">namespace</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">default</span></span>
<span class="line"><span style="color:#7EE787;">spec</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;"># 因为要实现高可用，所以配置3个pod副本 </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">replicas</span><span style="color:#C9D1D9;">: </span><span style="color:#79C0FF;">3</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">strategy</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">type</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">Recreate</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">selector</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">matchLabels</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#7EE787;">app</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">template</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#7EE787;">labels</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#7EE787;">app</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">spec</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#7EE787;">serviceAccountName</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#7EE787;">containers</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">        - </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#7EE787;">image</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">willdockerhub/nfs-subdir-external-provisioner:v4.0.2</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#7EE787;">volumeMounts</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">            - </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-root</span></span>
<span class="line"><span style="color:#C9D1D9;">              </span><span style="color:#7EE787;">mountPath</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">/persistentvolumes</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#7EE787;">env</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">            - </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">PROVISIONER_NAME</span></span>
<span class="line"><span style="color:#C9D1D9;">              </span><span style="color:#7EE787;">value</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">k8s-sigs.io/nfs-subdir-external-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">            - </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">NFS_SERVER</span></span>
<span class="line"><span style="color:#C9D1D9;">              </span><span style="color:#7EE787;">value</span><span style="color:#C9D1D9;">: </span><span style="color:#79C0FF;">192.168.229.132</span></span>
<span class="line"><span style="color:#C9D1D9;">            - </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">NFS_PATH</span></span>
<span class="line"><span style="color:#C9D1D9;">              </span><span style="color:#7EE787;">value</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">/mnt/data/nfs_data</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#7EE787;">volumes</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">        - </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-root</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#7EE787;">nfs</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#7EE787;">server</span><span style="color:#C9D1D9;">: </span><span style="color:#79C0FF;">192.168.229.132</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#7EE787;">path</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">/mnt/data/nfs_data</span></span>
<span class="line"></span></code></pre></div><h2 id="部署storage-class" tabindex="-1">部署storage class <a class="header-anchor" href="#部署storage-class" aria-hidden="true">#</a></h2><p>执行如下命令，创建sc</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#C9D1D9;">kubectl apply -f class.yaml</span></span>
<span class="line"></span></code></pre></div><p>执行如下命令查看是否配置成功</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#C9D1D9;">kubectl get sc</span></span>
<span class="line"></span></code></pre></div><p>parameters的详细配置，请参考<a href="https://github.com/lorenzofaresin/nfs-subdir-external-provisioner" target="_blank" rel="noopener noreferrer">nfs-subdir-external-provisioner</a>的配置<br> class.yaml文件参考如下</p><div class="language-yaml"><span class="copy"></span><pre><code><span class="line"><span style="color:#7EE787;">apiVersion</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">storage.k8s.io/v1</span></span>
<span class="line"><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">StorageClass</span></span>
<span class="line"><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client</span></span>
<span class="line"><span style="color:#7EE787;">provisioner</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">k8s-sigs.io/nfs-subdir-external-provisioner</span><span style="color:#C9D1D9;"> </span><span style="color:#8B949E;"># or choose another name, must match deployment&#39;s env PROVISIONER_NAME&#39;</span></span>
<span class="line"><span style="color:#7EE787;">parameters</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">archiveOnDelete</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">&quot;false&quot;</span></span>
<span class="line"></span></code></pre></div><p>配置默认storageclass</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#C9D1D9;">kubectl patch storageclass nfs-client -p </span><span style="color:#A5D6FF;">&#39;{&quot;metadata&quot;: {&quot;annotations&quot;:{&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;}}}&#39;</span></span>
<span class="line"></span></code></pre></div><h2 id="验证nfs的配置" tabindex="-1">验证nfs的配置 <a class="header-anchor" href="#验证nfs的配置" aria-hidden="true">#</a></h2><p>可以通过创建一个PVC，然后关联一个POD进行查看<br> PVC测试文件test-claim.yaml参考如下：</p><div class="language-yaml"><span class="copy"></span><pre><code><span class="line"><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#7EE787;">apiVersion</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">v1</span></span>
<span class="line"><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">test-claim</span></span>
<span class="line"><span style="color:#7EE787;">spec</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">storageClassName</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">accessModes</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">    - </span><span style="color:#A5D6FF;">ReadWriteMany</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">resources</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">requests</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#7EE787;">storage</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">1Mi</span></span>
<span class="line"></span></code></pre></div><p>POD测试文件test-pod.yaml参考如下：</p><div class="language-yaml"><span class="copy"></span><pre><code><span class="line"><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">Pod</span></span>
<span class="line"><span style="color:#7EE787;">apiVersion</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">v1</span></span>
<span class="line"><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">test-pod</span></span>
<span class="line"><span style="color:#7EE787;">spec</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">containers</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  - </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">test-pod</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">image</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">busybox:stable</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">command</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">      - </span><span style="color:#A5D6FF;">&quot;/bin/sh&quot;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">args</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">      - </span><span style="color:#A5D6FF;">&quot;-c&quot;</span></span>
<span class="line"><span style="color:#C9D1D9;">      - </span><span style="color:#A5D6FF;">&quot;touch /mnt/SUCCESS &amp;&amp; exit 0 || exit 1&quot;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">volumeMounts</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">      - </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-pvc</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#7EE787;">mountPath</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">&quot;/mnt&quot;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">restartPolicy</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">&quot;Never&quot;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">volumes</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">    - </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-pvc</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#7EE787;">persistentVolumeClaim</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#7EE787;">claimName</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">test-claim</span></span>
<span class="line"></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-b2cd70aa data-v-56e38d21><!----><div class="prev-next" data-v-56e38d21><div class="pager" data-v-56e38d21><a class="pager-link prev" href="/packages/kubernetes/nfs/client.html" data-v-56e38d21><span class="desc" data-v-56e38d21>Previous page</span><span class="title" data-v-56e38d21>NFS客户端</span></a></div><div class="has-prev pager" data-v-56e38d21><!----></div></div></footer></div></div></div></div></div><footer class="VPFooter has-sidebar" data-v-e08996d6 data-v-5b331722><div class="container" data-v-5b331722><p class="message" data-v-5b331722>Released under the MIT License.</p><p class="copyright" data-v-5b331722>Copyright © 2019-present Evan You</p></div></footer></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"about_index.md\":\"63b3ea04\",\"index.md\":\"45503f29\",\"packages_kubernetes_index.md\":\"a89eea56\",\"packages_kubernetes_nfs_client.md\":\"56573b74\",\"packages_kubernetes_nfs_deploy.md\":\"5747cd9b\",\"packages_kubernetes_nfs_server.md\":\"e1e7cf98\",\"packages_teamcity_agent.md\":\"48268b55\",\"packages_teamcity_deploy.md\":\"a7e83847\",\"packages_teamcity_index.md\":\"32f41bf7\",\"packages_teamcity_server.md\":\"be979bee\"}")</script>
    <script type="module" async src="/assets/app.8d41e510.js"></script>
    
  </body>
</html>