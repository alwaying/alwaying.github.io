import{_ as s,c as n,o as a,d as l}from"./app.8d41e510.js";const F='{"title":"nfs\u5728kubernetes\u4E2D\u90E8\u7F72","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u4FEE\u6539\u547D\u540D\u7A7A\u95F4","slug":"\u4FEE\u6539\u547D\u540D\u7A7A\u95F4"},{"level":2,"title":"\u5B89\u88C5\u8BA4\u8BC1\u6587\u4EF6","slug":"\u5B89\u88C5\u8BA4\u8BC1\u6587\u4EF6"},{"level":2,"title":"\u914D\u7F6Enfs provisioner","slug":"\u914D\u7F6Enfs-provisioner"},{"level":2,"title":"\u90E8\u7F72storage class","slug":"\u90E8\u7F72storage-class"},{"level":2,"title":"\u9A8C\u8BC1nfs\u7684\u914D\u7F6E","slug":"\u9A8C\u8BC1nfs\u7684\u914D\u7F6E"}],"relativePath":"packages/kubernetes/nfs/deploy.md","lastUpdated":1671789631000}',p={},o=l(`<h1 id="nfs\u5728kubernetes\u4E2D\u90E8\u7F72" tabindex="-1">nfs\u5728kubernetes\u4E2D\u90E8\u7F72 <a class="header-anchor" href="#nfs\u5728kubernetes\u4E2D\u90E8\u7F72" aria-hidden="true">#</a></h1><p><a href="https://github.com/kubernetes-sigs/nfs-subdir-external-provisioner" target="_blank" rel="noopener noreferrer">nfs-subdir-external-provisioner</a>\u4E0B\u8F7D\u76F8\u5173\u6587\u4EF6\uFF0C\u4E3B\u8981\u4F7F\u7528rbac.yaml\u3001deployment.yaml\u3001class.yaml\u4E09\u4E2A\u6587\u4EF6\uFF0C\u4F4D\u4E8Edeploy\u76EE\u5F55\u4E0B\u3002</p><h2 id="\u4FEE\u6539\u547D\u540D\u7A7A\u95F4" tabindex="-1">\u4FEE\u6539\u547D\u540D\u7A7A\u95F4 <a class="header-anchor" href="#\u4FEE\u6539\u547D\u540D\u7A7A\u95F4" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#C9D1D9;">sed -i</span><span style="color:#A5D6FF;">&#39;&#39;</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&quot;s/namespace:.*/namespace: </span><span style="color:#C9D1D9;">$NAMESPACE</span><span style="color:#A5D6FF;">/g&quot;</span><span style="color:#C9D1D9;"> ./deploy/rbac.yaml ./deploy/deployment.yaml</span></span>
<span class="line"></span></code></pre></div><h2 id="\u5B89\u88C5\u8BA4\u8BC1\u6587\u4EF6" tabindex="-1">\u5B89\u88C5\u8BA4\u8BC1\u6587\u4EF6 <a class="header-anchor" href="#\u5B89\u88C5\u8BA4\u8BC1\u6587\u4EF6" aria-hidden="true">#</a></h2><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#C9D1D9;">kubectl apply -f ./deploy/rbac.yaml</span></span>
<span class="line"></span></code></pre></div><p>rbac.yaml\u53C2\u8003\u5982\u4E0B\uFF0C\u4EE5\u5B9E\u9645\u4E0B\u8F7D\u6587\u4EF6\u4E3A\u51C6</p><div class="language-yaml"><span class="copy"></span><pre><code><span class="line"><span style="color:#7EE787;">apiVersion</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">v1</span></span>
<span class="line"><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">ServiceAccount</span></span>
<span class="line"><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">namespace</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">default</span></span>
<span class="line"><span style="color:#79C0FF;">---</span></span>
<span class="line"><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">ClusterRole</span></span>
<span class="line"><span style="color:#7EE787;">apiVersion</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner-runner</span></span>
<span class="line"><span style="color:#7EE787;">rules</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  - </span><span style="color:#7EE787;">apiGroups</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">resources</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;nodes&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">verbs</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;get&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;list&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;watch&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">  - </span><span style="color:#7EE787;">apiGroups</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">resources</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;persistentvolumes&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">verbs</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;get&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;list&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;watch&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;create&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;delete&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">  - </span><span style="color:#7EE787;">apiGroups</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">resources</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;persistentvolumeclaims&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">verbs</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;get&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;list&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;watch&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;update&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">  - </span><span style="color:#7EE787;">apiGroups</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;storage.k8s.io&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">resources</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;storageclasses&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">verbs</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;get&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;list&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;watch&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">  - </span><span style="color:#7EE787;">apiGroups</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">resources</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;events&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">verbs</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;create&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;update&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;patch&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#79C0FF;">---</span></span>
<span class="line"><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">ClusterRoleBinding</span></span>
<span class="line"><span style="color:#7EE787;">apiVersion</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">run-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#7EE787;">subjects</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  - </span><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">ServiceAccount</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">namespace</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">default</span></span>
<span class="line"><span style="color:#7EE787;">roleRef</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">ClusterRole</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner-runner</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">apiGroup</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">rbac.authorization.k8s.io</span></span>
<span class="line"><span style="color:#79C0FF;">---</span></span>
<span class="line"><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">Role</span></span>
<span class="line"><span style="color:#7EE787;">apiVersion</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">leader-locking-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">namespace</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">default</span></span>
<span class="line"><span style="color:#7EE787;">rules</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  - </span><span style="color:#7EE787;">apiGroups</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">resources</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;endpoints&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">verbs</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&quot;get&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;list&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;watch&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;create&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;update&quot;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&quot;patch&quot;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#79C0FF;">---</span></span>
<span class="line"><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">RoleBinding</span></span>
<span class="line"><span style="color:#7EE787;">apiVersion</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">rbac.authorization.k8s.io/v1</span></span>
<span class="line"><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">leader-locking-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">namespace</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">default</span></span>
<span class="line"><span style="color:#7EE787;">subjects</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  - </span><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">ServiceAccount</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">namespace</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">default</span></span>
<span class="line"><span style="color:#7EE787;">roleRef</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">Role</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">leader-locking-nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">apiGroup</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">rbac.authorization.k8s.io</span></span>
<span class="line"></span></code></pre></div><h2 id="\u914D\u7F6Enfs-provisioner" tabindex="-1">\u914D\u7F6Enfs provisioner <a class="header-anchor" href="#\u914D\u7F6Enfs-provisioner" aria-hidden="true">#</a></h2><p>\u66FF\u6362\u539F\u59CB\u955C\u50CF: <code>k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2</code>\u4E3A<code>willdockerhub/nfs-subdir-external-provisioner:v4.0.2</code><br> \u66FF\u6362\u6389NFS_SERVER\u3001NFS_PATH\u7684\u53C2\u6570\u503C\uFF0Cvolumes\u53C2\u6570\u4E0B\u7684server\uFF0Cpath\u53C2\u6570\u5373\u53EF\uFF0C\u8FD9\u4E9B\u53C2\u6570\u5747\u4E3A\u4E0A\u8FF0\u914D\u7F6E\u7684NFS SERVER\u7684\u4FE1\u606F deployment.yaml\u6587\u4EF6\u5185\u5BB9\u53C2\u8003\u5982\u4E0B</p><div class="language-yaml"><span class="copy"></span><pre><code><span class="line"><span style="color:#7EE787;">apiVersion</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">apps/v1</span></span>
<span class="line"><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">Deployment</span></span>
<span class="line"><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">labels</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">app</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;"># replace with namespace where provisioner is deployed</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">namespace</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">default</span></span>
<span class="line"><span style="color:#7EE787;">spec</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;"># \u56E0\u4E3A\u8981\u5B9E\u73B0\u9AD8\u53EF\u7528\uFF0C\u6240\u4EE5\u914D\u7F6E3\u4E2Apod\u526F\u672C </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">replicas</span><span style="color:#C9D1D9;">: </span><span style="color:#79C0FF;">3</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">strategy</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">type</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">Recreate</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">selector</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">matchLabels</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#7EE787;">app</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">template</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#7EE787;">labels</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#7EE787;">app</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">spec</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#7EE787;">serviceAccountName</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#7EE787;">containers</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">        - </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#7EE787;">image</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">willdockerhub/nfs-subdir-external-provisioner:v4.0.2</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#7EE787;">volumeMounts</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">            - </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-root</span></span>
<span class="line"><span style="color:#C9D1D9;">              </span><span style="color:#7EE787;">mountPath</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">/persistentvolumes</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#7EE787;">env</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">            - </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">PROVISIONER_NAME</span></span>
<span class="line"><span style="color:#C9D1D9;">              </span><span style="color:#7EE787;">value</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">k8s-sigs.io/nfs-subdir-external-provisioner</span></span>
<span class="line"><span style="color:#C9D1D9;">            - </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">NFS_SERVER</span></span>
<span class="line"><span style="color:#C9D1D9;">              </span><span style="color:#7EE787;">value</span><span style="color:#C9D1D9;">: </span><span style="color:#79C0FF;">192.168.229.132</span></span>
<span class="line"><span style="color:#C9D1D9;">            - </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">NFS_PATH</span></span>
<span class="line"><span style="color:#C9D1D9;">              </span><span style="color:#7EE787;">value</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">/mnt/data/nfs_data</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#7EE787;">volumes</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">        - </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client-root</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#7EE787;">nfs</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#7EE787;">server</span><span style="color:#C9D1D9;">: </span><span style="color:#79C0FF;">192.168.229.132</span></span>
<span class="line"><span style="color:#C9D1D9;">            </span><span style="color:#7EE787;">path</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">/mnt/data/nfs_data</span></span>
<span class="line"></span></code></pre></div><h2 id="\u90E8\u7F72storage-class" tabindex="-1">\u90E8\u7F72storage class <a class="header-anchor" href="#\u90E8\u7F72storage-class" aria-hidden="true">#</a></h2><p>\u6267\u884C\u5982\u4E0B\u547D\u4EE4\uFF0C\u521B\u5EFAsc</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#C9D1D9;">kubectl apply -f class.yaml</span></span>
<span class="line"></span></code></pre></div><p>\u6267\u884C\u5982\u4E0B\u547D\u4EE4\u67E5\u770B\u662F\u5426\u914D\u7F6E\u6210\u529F</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#C9D1D9;">kubectl get sc</span></span>
<span class="line"></span></code></pre></div><p>parameters\u7684\u8BE6\u7EC6\u914D\u7F6E\uFF0C\u8BF7\u53C2\u8003<a href="https://github.com/lorenzofaresin/nfs-subdir-external-provisioner" target="_blank" rel="noopener noreferrer">nfs-subdir-external-provisioner</a>\u7684\u914D\u7F6E<br> class.yaml\u6587\u4EF6\u53C2\u8003\u5982\u4E0B</p><div class="language-yaml"><span class="copy"></span><pre><code><span class="line"><span style="color:#7EE787;">apiVersion</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">storage.k8s.io/v1</span></span>
<span class="line"><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">StorageClass</span></span>
<span class="line"><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client</span></span>
<span class="line"><span style="color:#7EE787;">provisioner</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">k8s-sigs.io/nfs-subdir-external-provisioner</span><span style="color:#C9D1D9;"> </span><span style="color:#8B949E;"># or choose another name, must match deployment&#39;s env PROVISIONER_NAME&#39;</span></span>
<span class="line"><span style="color:#7EE787;">parameters</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">archiveOnDelete</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">&quot;false&quot;</span></span>
<span class="line"></span></code></pre></div><p>\u914D\u7F6E\u9ED8\u8BA4storageclass</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#C9D1D9;">kubectl patch storageclass nfs-client -p </span><span style="color:#A5D6FF;">&#39;{&quot;metadata&quot;: {&quot;annotations&quot;:{&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;}}}&#39;</span></span>
<span class="line"></span></code></pre></div><h2 id="\u9A8C\u8BC1nfs\u7684\u914D\u7F6E" tabindex="-1">\u9A8C\u8BC1nfs\u7684\u914D\u7F6E <a class="header-anchor" href="#\u9A8C\u8BC1nfs\u7684\u914D\u7F6E" aria-hidden="true">#</a></h2><p>\u53EF\u4EE5\u901A\u8FC7\u521B\u5EFA\u4E00\u4E2APVC\uFF0C\u7136\u540E\u5173\u8054\u4E00\u4E2APOD\u8FDB\u884C\u67E5\u770B<br> PVC\u6D4B\u8BD5\u6587\u4EF6test-claim.yaml\u53C2\u8003\u5982\u4E0B\uFF1A</p><div class="language-yaml"><span class="copy"></span><pre><code><span class="line"><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">PersistentVolumeClaim</span></span>
<span class="line"><span style="color:#7EE787;">apiVersion</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">v1</span></span>
<span class="line"><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">test-claim</span></span>
<span class="line"><span style="color:#7EE787;">spec</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">storageClassName</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-client</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">accessModes</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">    - </span><span style="color:#A5D6FF;">ReadWriteMany</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">resources</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">requests</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#7EE787;">storage</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">1Mi</span></span>
<span class="line"></span></code></pre></div><p>POD\u6D4B\u8BD5\u6587\u4EF6test-pod.yaml\u53C2\u8003\u5982\u4E0B\uFF1A</p><div class="language-yaml"><span class="copy"></span><pre><code><span class="line"><span style="color:#7EE787;">kind</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">Pod</span></span>
<span class="line"><span style="color:#7EE787;">apiVersion</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">v1</span></span>
<span class="line"><span style="color:#7EE787;">metadata</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">test-pod</span></span>
<span class="line"><span style="color:#7EE787;">spec</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">containers</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">  - </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">test-pod</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">image</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">busybox:stable</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">command</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">      - </span><span style="color:#A5D6FF;">&quot;/bin/sh&quot;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">args</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">      - </span><span style="color:#A5D6FF;">&quot;-c&quot;</span></span>
<span class="line"><span style="color:#C9D1D9;">      - </span><span style="color:#A5D6FF;">&quot;touch /mnt/SUCCESS &amp;&amp; exit 0 || exit 1&quot;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#7EE787;">volumeMounts</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">      - </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-pvc</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#7EE787;">mountPath</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">&quot;/mnt&quot;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">restartPolicy</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">&quot;Never&quot;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#7EE787;">volumes</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">    - </span><span style="color:#7EE787;">name</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">nfs-pvc</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#7EE787;">persistentVolumeClaim</span><span style="color:#C9D1D9;">:</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#7EE787;">claimName</span><span style="color:#C9D1D9;">: </span><span style="color:#A5D6FF;">test-claim</span></span>
<span class="line"></span></code></pre></div>`,25),e=[o];function c(t,r,D,y,i,C){return a(),n("div",null,e)}var u=s(p,[["render",c]]);export{F as __pageData,u as default};
